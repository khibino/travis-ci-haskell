## -*- sh -*-

custom_retry() {
    i=0
    until "$@" ; do
        if [ $i -ge 3 ]; then
            break;
        fi
        sleep 1
        i=$(expr $i + 1)
    done
}

cabal_common() {
    cat <<EOF
remote-repo: hackage.haskell.org:http://hackage.haskell.org/packages/archive
remote-repo-cache: ${HOME}/.cabal/packages
world-file: ${HOME}/.cabal/world
build-summary: ${HOME}/.cabal/logs/build.log
remote-build-reporting: anonymous
EOF
}

skip_not_lts_branch () {
    set +x
    cat <<EOF
STACK_RESOLVER: $STACK_RESOLVER
TRAVIS_BRANCH: $TRAVIS_BRANCH
EOF
    case x"$STACK_RESOLVER" in
        xlts-[678]*)
            case x"$TRAVIS_BRANCH" in
                xlts-*)
                    cat <<EOF
STACK_RESOLVER is LTS and TRAVIS_BRANCH is LTS.
EOF
                    ;;
                *)
                    cat <<EOF
Skipping. STACK_RESOLVER is LTS and TRAVIS_BRANCH is NOT LTS.
EOF
                    set -x
                    exit 0
                    ;;
            esac
            ;;
        *)
            case x"$TRAVIS_BRANCH" in
                xlts-*)
                    cat <<EOF
Skipping. STACK_RESOLVER is not LTS and TRAVIS_BRANCH is LTS
EOF
                    ;;
                *)
                    cat <<EOF
STACK_RESOLVER is not LTS and TRAVIS_BRANCH is NOT LTS.
EOF
                    ;;
            esac
            ;;
    esac
    set -x
}
